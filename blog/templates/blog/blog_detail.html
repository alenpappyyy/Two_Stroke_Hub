{% extends 'base.html' %}
{% block content %}
<div class="max-w-4xl mx-auto py-10">
  <article class="bg-white p-6 rounded shadow">
    <h1 class="text-3xl font-bold mb-2">{{ post.title }}</h1>
    <p class="text-sm text-gray-500">By {{ post.author.username }} · {{ post.created_at|date:"M d, Y" }}</p>
    {% if post.image %}
      <img src="{{ post.image.url }}" class="w-full h-64 object-cover rounded mt-4 mb-4">
    {% endif %}
    <div class="prose max-w-none">
      {{ post.content|linebreaks }}
    </div>

    <div class="mt-4">
      <strong>Categories:</strong>
      {% for c in post.categories.all %}
        <a href="{% url 'blog_list' %}?category={{ c.slug }}" class="px-2 py-1 border rounded text-sm">{{ c.name }}</a>
      {% endfor %}
    </div>
    <div class="mt-2">
      <strong>Tags:</strong>
      {% for t in post.tags.all %}
        <a href="{% url 'blog_list' %}?tag={{ t.slug }}" class="px-2 py-1 border rounded text-sm">{{ t.name }}</a>
      {% endfor %}
    </div>
  </article>

  <!-- Comments -->
  <section class="mt-8">
    <h3 class="text-xl font-semibold mb-3">Comments ({{ comments.count }})</h3>
    <div class="space-y-4">
      {% for c in comments %}
        <div class="bg-white p-4 rounded shadow">
          <p class="text-sm text-gray-600">{{ c.user.username if c.user else c.name }} · {{ c.created_at|date:"M d, Y H:i" }}</p>
          <p class="mt-1">{{ c.body|linebreaks }}</p>
        </div>
      {% empty %}
        <p class="text-gray-600">No comments yet.</p>
      {% endfor %}
    </div>

    <div class="mt-6 bg-white p-4 rounded shadow">
      <h4 class="font-semibold mb-2">Leave a comment</h4>
      <form method="post">{% csrf_token %}
        {{ comment_form.body }}
        {% if not user.is_authenticated %}
          <div class="mt-2">{{ comment_form.name }}</div>
        {% endif %}
        <button class="mt-3 bg-orange-500 text-white px-4 py-2 rounded">Post Comment</button>
      </form>
    </div>
  </section>
</div>
{% endblock %}
